(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)):(t.disabled=!0,t.classList.add(r.inactiveButtonClass))}e.d({},{B:()=>p});var r=".popup__close",n=".popup__form";function o(e,t){"Escape"===e.key&&u(t)}function c(e,t){e.target===t&&u(t)}function a(e){e.classList.add("popup_is-opened"),e.querySelector(r).addEventListener("click",(function(){return u(e)})),document.addEventListener("keydown",(function(t){o(t,e)})),e.addEventListener("click",(function(t){console.log(t),c(t,e)}))}function u(e){var t,a;e.classList.remove("popup_is-opened"),e.querySelector(n)&&(t=e.querySelector(n),a=p,t.querySelectorAll("input").forEach((function(e){var r=t.querySelector(".".concat(e.name,"-error"));e.classList.remove(a.inputErrorClass),r.classList.remove(a.errorClass),r.textContent=""})),t.reset()),e.querySelector(r).removeEventListener("click",(function(){return u(e)})),document.removeEventListener("keydown",(function(t){o(t,e)})),e.removeEventListener("click",(function(t){return c(t,e)}))}var i={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"","Content-Type":"application/json"}};i.headers.authorization="cdf4159a-a74e-439b-921e-3b1f0a6b2d4f";var s,l=function(){return fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.json()}))};function d(e){console.log(e);var t=document.querySelector("#template").content.querySelector(".places__item").cloneNode(!0),r=t.querySelector(".card__like-button"),n=t.querySelector(".card__delete-button");return t.id=e._id,t.querySelector(".card__image").src=e.link,t.querySelector(".card__description").querySelector(".card__title").textContent=e.name,t.querySelector(".card__like-counter").textContent=e.likes.length,e.likes.find((function(e){return e._id===s}))&&r.classList.add("card__like-button_is-active"),s!==e.owner._id&&(n.style.display="none"),t}l().then((function(e){s=e._id}));var p,_=document.querySelector(".profile__image"),f=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),v=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),S=document.querySelector(".places__list");_.addEventListener("click",(function(){var e=document.querySelector(".popup_type_avatar"),t=e.querySelector(".popup__close"),r=e.querySelector(".popup__button"),n=e.querySelector("form"),o=e.querySelector(".popup__input_type_url");a(e),t.addEventListener("click",(function(){u(e)})),n.addEventListener("submit",(function t(c){c.preventDefault();var a,s=o.value;r.textContent="Сохраняем...",r.disabled=!0,(a=s,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:a})}).then((function(e){if(!e.ok)throw new Error("Ошибка: ".concat(e.status));return e.json()}))).then((function(){_.style.backgroundImage="url(".concat(s,")")})).finally((function(){r.textContent="Сохранить",r.disabled=!1,u(e)})),n.removeEventListener("submit",t)}))})),v.addEventListener("click",(function(){var e=document.querySelector(".popup_type_edit"),t=(e.querySelector(".popup__close"),e.querySelector("form")),r=e.querySelector(".popup__input_type_name"),n=e.querySelector(".popup__input_type_description"),o=t.querySelector("button");r.value=f.textContent,n.value=y.textContent,a(e),t.addEventListener("submit",(function(t){var c,a;t.preventDefault(),o.textContent="Сохраняем...",o.disabled=!0,(c=r.value,a=n.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:c,about:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){f.textContent=e.name,y.textContent=e.about})).finally((function(){u(e),o.textContent="Сохранить",o.disabled=!1}))}))})),S.addEventListener("click",(function(e){!function(e){var t,r,n=e.target,o=n.parentNode,c=document.querySelector(".popup_type_image"),s=c.querySelector(".popup__close");n.classList.contains("card__delete-button")?(t=n.parentNode,r=t.getAttribute("id"),fetch("".concat(i.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:i.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})),t.remove()):n.classList.contains("card__like-button")?function(e){var t,r=e.querySelector(".card__like"),n=r.querySelector(".card__like-button");function o(e){var t=r.querySelector(".card__like-counter");n.classList.toggle("card__like-button_is-active"),t.textContent=e.likes.length}n.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e.getAttribute("id")).then((function(e){return o(e)})):(t=e.getAttribute("id"),fetch("".concat(i.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return o(e)}))}(n.parentNode.parentNode.parentNode):n.classList.contains("card__image")&&(a(c),s.addEventListener("click",(function(){u(c)})),c.querySelector(".popup__caption").textContent=o.querySelector(".card__title").textContent,c.querySelector(".popup__image").src=n.src,c.querySelector(".popup__image").alt=String(o.querySelector(".card__title").textContent))}(e)})),m.addEventListener("click",(function(){var e=document.querySelector(".popup_type_new-card"),t=(e.querySelector(".popup__close"),e.querySelector("form")),r=e.querySelector(".popup__input_type_card-name"),n=e.querySelector(".popup__input_type_url"),o=t.querySelector("button");a(e),t.addEventListener("submit",(function(t){var c,a;t.preventDefault(),o.textContent="Сохраняем...",o.disabled=!0,(c=r.value,a=n.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:c,link:a})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),S.prepend(d(e))})).finally((function(){u(e),e.querySelector(".popup__input_type_card-name").value="",e.querySelector(".popup__input_type_url").value="",o.textContent="Сохранить",o.disabled=!1}))}))})),p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};for(var h,b=document.querySelectorAll(".popup"),q=0;q<b.length;q++)b[q].classList.add("popup_is-animated");Promise.all([l(),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.json()}))]).then((function(e){_.style.backgroundImage="url(".concat(e[0].avatar,")"),f.textContent=e[0].name,y.textContent=e[0].about;for(var t=0;t<e[1].length;t++)r=d(e[1][t]),S.append(r);var r})),h=p,Array.from(document.querySelectorAll(h.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,r){var n=Array.from(e.querySelectorAll(r.inputSelector)),o=e.querySelector(r.submitButtonSelector);t(n,o,r),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,r){var n=e.querySelector(".".concat(t.name,"-error"));if(t.validity.valid)t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent="";else{var o=t.validationMessage;t.classList.add(r.inputErrorClass),n.classList.add(r.errorClass),n.textContent=o}}(e,c,r),t(n,o,r)}))}))}(e,h)}))})();